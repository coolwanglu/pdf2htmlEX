<div class="pd w0 h0"><div id="pfa" class="pf" data-page-no="a"><div class="pc pca"><img class="bi x32 ye0 wb h1e" alt="" src="data:image/png;base64,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"/><div class="t m0 x2f hc y5b ff1 fs3 fc0 sc0 ls0 ws0">6.5<span class="_ _9"> </span>Calling<span class="_ _5"> </span>External<span class="_ _5"> </span>Functions</div><div class="t m0 x2f h5 y1e2 ff2 fs3 fc0 sc0 ls0 ws0">Like<span class="_ _5"> </span>most<span class="_ _5"> </span>interpreters,<span class="_ _3"> </span>SpiderMonk<span class="_ _2"></span>e<span class="_ _2"></span>y<span class="_ _5"> </span>has<span class="_ _3"> </span>a<span class="_ _5"> </span>foreign<span class="_ _5"> </span>function<span class="_ _5"> </span>inter-</div><div class="t m0 x2f h5 y1e3 ff2 fs3 fc0 sc0 ls0 ws0">face<span class="_ _5"> </span>(FFI)<span class="_ _5"> </span>that<span class="_ _5"> </span>allo<span class="_ _2"></span>ws<span class="_ _5"> </span>it<span class="_ _7"> </span>to<span class="_ _5"> </span>call<span class="_ _5"> </span>C<span class="_ _5"> </span>builtins<span class="_ _5"> </span>and<span class="_ _5"> </span>host<span class="_ _7"> </span>system<span class="_ _5"> </span>functions</div><div class="t m0 x2f h5 y1e4 ff2 fs3 fc0 sc0 ls0 ws0">(e.g.,<span class="_ _3"> </span>web<span class="_ _3"> </span>bro<span class="_ _2"></span>wser<span class="_ _3"> </span>control<span class="_ _3"> </span>and<span class="_ _3"> </span>DOM<span class="_ _3"> </span>access).<span class="_ _3"> </span>The<span class="_ _3"> </span>FFI<span class="_ _3"> </span>has<span class="_ _5"> </span>a<span class="_ _3"> </span>stan-</div><div class="t m0 x2f h5 y1e5 ff2 fs3 fc0 sc0 ls0 ws0">dard<span class="_ _5"> </span>signature<span class="_ _5"> </span>for<span class="_ _7"> </span>JS-callable<span class="_ _5"> </span>functions,<span class="_ _5"> </span>the<span class="_ _5"> </span>k<span class="_ _2"></span>ey<span class="_ _5"> </span>ar<span class="_ _2"></span>gument<span class="_ _5"> </span>of<span class="_ _7"> </span>which</div><div class="t m0 x2f h5 y1e6 ff2 fs3 fc0 sc0 ls0 ws0">is<span class="_ _3"> </span>an<span class="_ _3"> </span>array<span class="_ _3"> </span>of<span class="_ _6"> </span>box<span class="_ _2"></span>ed<span class="_ _3"> </span>values.<span class="_ _3"> </span>External<span class="_ _3"> </span>functions<span class="_ _3"> </span>called<span class="_ _3"> </span>through<span class="_ _3"> </span>the</div><div class="t m0 x2f h5 y3 ff2 fs3 fc0 sc0 ls0 ws0">FFI<span class="_ _5"> </span>interact<span class="_ _7"> </span>with<span class="_ _5"> </span>the<span class="_ _5"> </span>program<span class="_ _7"> </span>state<span class="_ _5"> </span>through<span class="_ _5"> </span>an<span class="_ _7"> </span>interpreter<span class="_ _5"> </span>API<span class="_ _5"> </span>(e.g.,</div><div class="t m0 x2f h5 y1e7 ff2 fs3 fc0 sc0 ls0 ws0">to<span class="_ _3"> </span>read<span class="_ _5"> </span>a<span class="_ _3"> </span>property<span class="_ _5"> </span>from<span class="_ _3"> </span>an<span class="_ _3"> </span>ar<span class="_ _2"></span>gument).<span class="_ _5"> </span>There<span class="_ _3"> </span>are<span class="_ _3"> </span>also<span class="_ _5"> </span>certain<span class="_ _3"> </span>inter<span class="_ _2"></span>-</div><div class="t m0 x2f h5 y1e8 ff2 fs3 fc0 sc0 ls0 ws0">preter<span class="_ _5"> </span>b<span class="_ _2"></span>uiltins<span class="_ _5"> </span>that<span class="_ _5"> </span>do<span class="_ _7"> </span>not<span class="_ _5"> </span>use<span class="_ _5"> </span>the<span class="_ _5"> </span>FFI,<span class="_ _7"> </span>but<span class="_ _5"> </span>interact<span class="_ _5"> </span>with<span class="_ _7"> </span>the<span class="_ _5"> </span>program</div><div class="t m0 x2f h5 y6 ff2 fs3 fc0 sc0 ls0 ws0">state<span class="_ _6"> </span>in<span class="_ _8"> </span>the<span class="_ _6"> </span>same<span class="_ _6"> </span>way<span class="_ _2"></span>,<span class="_ _6"> </span>such<span class="_ _6"> </span>as<span class="_ _6"> </span>the<span class="_ _8"> </span><span class="ff7">CallIteratorNext<span class="_ _6"> </span></span>function</div><div class="t m0 x2f h5 y1e9 ff2 fs3 fc0 sc0 ls0 ws0">used<span class="_ _3"> </span>with<span class="_ _6"> </span>iterator<span class="_ _3"> </span>objects.<span class="_ _6"> </span>T<span class="_ _2"></span>raceMonk<span class="_ _2"></span>ey<span class="_ _3"> </span>must<span class="_ _3"> </span>support<span class="_ _6"> </span>this<span class="_ _3"> </span>FFI<span class="_ _6"> </span>in</div><div class="t m0 x2f h5 y1ea ff2 fs3 fc0 sc0 ls0 ws0">order<span class="_ _5"> </span>to<span class="_ _5"> </span>speed<span class="_ _7"> </span>up<span class="_ _5"> </span>code<span class="_ _5"> </span>that<span class="_ _7"> </span>interacts<span class="_ _5"> </span>with<span class="_ _5"> </span>the<span class="_ _7"> </span>host<span class="_ _5"> </span>system<span class="_ _5"> </span>inside<span class="_ _7"> </span>hot</div><div class="t m0 x2f h5 y1eb ff2 fs3 fc0 sc0 ls0 ws0">loops.</div><div class="t m0 x34 h5 y1bd ff2 fs3 fc0 sc0 ls0 ws0">Calling<span class="_ _5"> </span>e<span class="_ _2"></span>xternal<span class="_ _5"> </span>functions<span class="_ _5"> </span>from<span class="_ _5"> </span>T<span class="_ _b"></span>raceMonkey<span class="_ _5"> </span>is<span class="_ _5"> </span>potentially<span class="_ _7"> </span>dif-</div><div class="t m0 x2f h5 y1be ff2 fs3 fc0 sc0 ls0 ws0">ﬁcult<span class="_ _3"> </span>because<span class="_ _6"> </span>traces<span class="_ _3"> </span>do<span class="_ _6"> </span>not<span class="_ _3"> </span>update<span class="_ _6"> </span>the<span class="_ _3"> </span>interpreter<span class="_ _6"> </span>state<span class="_ _3"> </span>until<span class="_ _6"> </span>exit-</div><div class="t m0 x2f h5 y1bf ff2 fs3 fc0 sc0 ls0 ws0">ing.<span class="_ _3"> </span>In<span class="_ _5"> </span>particular<span class="_ _2"></span>,<span class="_ _5"> </span>external<span class="_ _5"> </span>functions<span class="_ _3"> </span>may<span class="_ _5"> </span>need<span class="_ _3"> </span>the<span class="_ _5"> </span>call<span class="_ _3"> </span>stack<span class="_ _5"> </span>or<span class="_ _5"> </span>the</div><div class="t m0 x2f h5 y1c0 ff2 fs3 fc0 sc0 ls0 ws0">global<span class="_ _5"> </span>variables,<span class="_ _5"> </span>but<span class="_ _5"> </span>the<span class="_ _2"></span>y<span class="_ _5"> </span>may<span class="_ _5"> </span>be<span class="_ _3"> </span>out<span class="_ _5"> </span>of<span class="_ _5"> </span>date.</div><div class="t m0 x34 h5 y23b ff2 fs3 fc0 sc0 ls0 ws0">For<span class="_ _3"> </span>the<span class="_ _6"> </span>out-of-date<span class="_ _6"> </span>call<span class="_ _3"> </span>stack<span class="_ _6"> </span>problem,<span class="_ _6"> </span>we<span class="_ _6"> </span>refactored<span class="_ _3"> </span>some<span class="_ _6"> </span>of</div><div class="t m0 x2f h5 y23c ff2 fs3 fc0 sc0 ls0 ws0">the<span class="_ _3"> </span>interpreter<span class="_ _3"> </span>API<span class="_ _3"> </span>implementation<span class="_ _3"> </span>functions<span class="_ _3"> </span>to<span class="_ _3"> </span>re-materialize<span class="_ _3"> </span>the</div><div class="t m0 x2f h5 y23d ff2 fs3 fc0 sc0 ls0 ws0">interpreter<span class="_ _5"> </span>call<span class="_ _5"> </span>stack<span class="_ _3"> </span>on<span class="_ _5"> </span>demand.</div><div class="t m0 x34 h5 y1c2 ff2 fs3 fc0 sc0 ls0 ws0">W<span class="_ _b"></span>e<span class="_ _3"> </span>developed<span class="_ _3"> </span>a<span class="_ _3"> </span>C++<span class="_ _3"> </span>static<span class="_ _3"> </span>analysis<span class="_ _3"> </span>and<span class="_ _3"> </span>annotated<span class="_ _3"> </span>some<span class="_ _3"> </span>inter-</div><div class="t m0 x2f h5 y23e ff2 fs3 fc0 sc0 ls0 ws0">preter<span class="_ _6"> </span>functions<span class="_ _6"> </span>in<span class="_ _6"> </span>order<span class="_ _8"> </span>to<span class="_ _6"> </span>verify<span class="_ _6"> </span>that<span class="_ _6"> </span>the<span class="_ _6"> </span>call<span class="_ _6"> </span>stack<span class="_ _6"> </span>is<span class="_ _8"> </span>refreshed</div><div class="t m0 x2f h5 y23f ff2 fs3 fc0 sc0 ls0 ws0">at<span class="_ _3"> </span>any<span class="_ _6"> </span>point<span class="_ _3"> </span>it<span class="_ _3"> </span>needs<span class="_ _6"> </span>to<span class="_ _3"> </span>be<span class="_ _6"> </span>used.<span class="_ _3"> </span>In<span class="_ _6"> </span>order<span class="_ _3"> </span>to<span class="_ _3"> </span>access<span class="_ _6"> </span>the<span class="_ _3"> </span>call<span class="_ _6"> </span>stack,</div><div class="t m0 x2f h5 y240 ff2 fs3 fc0 sc0 ls0 ws0">a<span class="_ _1"> </span>function<span class="_ _d"> </span>must<span class="_ _1"> </span>be<span class="_ _d"> </span>annotated<span class="_ _1"> </span>as<span class="_ _d"> </span>either<span class="_ _1"> </span>F<span class="_ _4"></span><span class="fse">O<span class="_ _4"></span>R<span class="_ _4"></span>C<span class="_ _4"></span>ES<span class="_ _4"></span></span>S<span class="_ _4"></span><span class="fse">TAC<span class="_ _4"></span>K<span class="_ _1"> </span></span>or<span class="_ _1"> </span>R<span class="_ _4"></span><span class="fse">E<span class="_ _4"></span></span>-</div><div class="t m0 x2f h5 y241 ff2 fse fc0 sc0 ls0 ws0">Q<span class="_ _4"></span>U<span class="_ _4"></span>I R<span class="_ _4"></span>E<span class="_ _4"></span>S<span class="_ _4"></span><span class="fs3">S<span class="_ _4"></span></span>TAC<span class="_ _4"></span>K<span class="fs3">.<span class="_ _5"> </span>These<span class="_ _5"> </span>annotations<span class="_ _5"> </span>are<span class="_ _5"> </span>also<span class="_ _5"> </span>required<span class="_ _5"> </span>i<span class="_ _2"></span>n<span class="_ _5"> </span>order<span class="_ _5"> </span>to<span class="_ _5"> </span>call</span></div><div class="t m0 x2f h5 y242 ff2 fs3 fc0 sc0 ls0 ws0">R<span class="_ _4"></span><span class="fse">E<span class="_ _4"></span>Q<span class="_ _4"></span>UI<span class="_ _4"></span>R<span class="_ _4"></span>E<span class="_ _4"></span>S<span class="_ _4"></span></span>S<span class="_ _4"></span><span class="fse">T<span class="_ _2"></span>AC<span class="_ _4"></span>K<span class="_ _5"> </span><span class="fs3">functions,<span class="_ _5"> </span>which<span class="_ _5"> </span>are<span class="_ _5"> </span>presumed<span class="_ _5"> </span>to<span class="_ _5"> </span>access<span class="_ _5"> </span>the<span class="_ _7"> </span>call</span></span></div><div class="t m0 x2f h5 y243 ff2 fs3 fc0 sc0 ls0 ws0">stack<span class="_ _6"> </span>transiti<span class="_ _2"></span>vely<span class="_ _b"></span>.<span class="_ _8"> </span>F<span class="_ _4"></span><span class="fse">O<span class="_ _4"></span>R<span class="_ _4"></span>CE<span class="_ _4"></span>S<span class="_ _4"></span></span>S<span class="_ _4"></span><span class="fse">TAC<span class="_ _4"></span>K<span class="_ _6"> </span></span>is<span class="_ _6"> </span>a<span class="_ _6"> </span>trusted<span class="_ _6"> </span>annotation,<span class="_ _3"> </span>applied</div><div class="t m0 x2f h5 y244 ff2 fs3 fc0 sc0 ls0 ws0">to<span class="_ _5"> </span>only<span class="_ _5"> </span>5<span class="_ _7"> </span>functions,<span class="_ _5"> </span>that<span class="_ _5"> </span>means<span class="_ _5"> </span>the<span class="_ _7"> </span>function<span class="_ _5"> </span>refreshes<span class="_ _5"> </span>the<span class="_ _5"> </span>call<span class="_ _7"> </span>stack.</div><div class="t m0 x2f h5 y245 ff2 fs3 fc0 sc0 ls0 ws0">R<span class="_ _4"></span><span class="fse">E<span class="_ _4"></span>Q<span class="_ _4"></span>UI<span class="_ _4"></span>R<span class="_ _4"></span>E<span class="_ _4"></span>S<span class="_ _4"></span></span>S<span class="_ _4"></span><span class="fse">T<span class="_ _2"></span>AC<span class="_ _4"></span>K<span class="_ _6"> </span><span class="fs3">is<span class="_ _3"> </span>an<span class="_ _3"> </span>untrusted<span class="_ _3"> </span>annotation<span class="_ _3"> </span>that<span class="_ _3"> </span>means<span class="_ _5"> </span>the<span class="_ _3"> </span>func-</span></span></div><div class="t m0 x2f h5 y246 ff2 fs3 fc0 sc0 ls0 ws0">tion<span class="_ _5"> </span>may<span class="_ _5"> </span>only<span class="_ _5"> </span>be<span class="_ _5"> </span>called<span class="_ _5"> </span>if<span class="_ _5"> </span>the<span class="_ _5"> </span>call<span class="_ _7"> </span>stack<span class="_ _5"> </span>has<span class="_ _5"> </span>already<span class="_ _5"> </span>been<span class="_ _5"> </span>refreshed.</div><div class="t m0 x34 h5 y247 ff2 fs3 fc0 sc0 ls0 ws0">Similarly<span class="_ _2"></span>,<span class="_ _8"> </span>we<span class="_ _d"> </span>detect<span class="_ _d"> </span>when<span class="_ _d"> </span>host<span class="_ _d"> </span>functions<span class="_ _d"> </span>attempt<span class="_ _d"> </span>to<span class="_ _d"> </span>directly</div><div class="t m0 x2f h5 y248 ff2 fs3 fc0 sc0 ls0 ws0">read<span class="_ _5"> </span>or<span class="_ _5"> </span>write<span class="_ _5"> </span>global<span class="_ _5"> </span>v<span class="_ _2"></span>ariables,<span class="_ _5"> </span>and<span class="_ _5"> </span>force<span class="_ _5"> </span>the<span class="_ _5"> </span>currently<span class="_ _7"> </span>running<span class="_ _5"> </span>trace</div><div class="t m0 x2f h5 y249 ff2 fs3 fc0 sc0 ls0 ws0">to<span class="_ _8"> </span>side<span class="_ _8"> </span>exit.<span class="_ _6"> </span>This<span class="_ _8"> </span>is<span class="_ _8"> </span>necessary<span class="_ _8"> </span>since<span class="_ _8"> </span>we<span class="_ _8"> </span>cache<span class="_ _8"> </span>and<span class="_ _8"> </span>unbox<span class="_ _8"> </span>global</div><div class="t m0 x2f h5 y24a ff2 fs3 fc0 sc0 ls0 ws0">variables<span class="_ _5"> </span>into<span class="_ _5"> </span>the<span class="_ _5"> </span>activ<span class="_ _2"></span>ation<span class="_ _5"> </span>record<span class="_ _5"> </span>during<span class="_ _5"> </span>trace<span class="_ _5"> </span>execution.</div><div class="t m0 x34 h5 y24b ff2 fs3 fc0 sc0 ls0 ws0">Since<span class="_ _1"> </span>both<span class="_ _1"> </span>call-stack<span class="_ _1"> </span>access<span class="_ _1"> </span>and<span class="_ _1"> </span>global<span class="_ _1"> </span>variable<span class="_ _1"> </span>access<span class="_ _1"> </span>are</div><div class="t m0 x2f h5 y24c ff2 fs3 fc0 sc0 ls0 ws0">rarely<span class="_ _5"> </span>performed<span class="_ _7"> </span>by<span class="_ _7"> </span>host<span class="_ _5"> </span>functions,<span class="_ _7"> </span>performance<span class="_ _5"> </span>is<span class="_ _7"> </span>not<span class="_ _5"> </span>signiﬁcantly</div><div class="t m0 x2f h5 y24d ff2 fs3 fc0 sc0 ls0 ws0">affected<span class="_ _5"> </span>by<span class="_ _5"> </span>these<span class="_ _5"> </span>safety<span class="_ _5"> </span>mechanisms.</div><div class="t m0 x34 h5 y24e ff2 fs3 fc0 sc0 ls0 ws0">Another<span class="_ _5"> </span>problem<span class="_ _5"> </span>is<span class="_ _5"> </span>that<span class="_ _5"> </span>e<span class="_ _2"></span>xternal<span class="_ _5"> </span>functions<span class="_ _5"> </span>can<span class="_ _5"> </span>ree<span class="_ _2"></span>nter<span class="_ _5"> </span>the<span class="_ _5"> </span>inter<span class="_ _2"></span>-</div><div class="t m0 x2f h5 y24f ff2 fs3 fc0 sc0 ls0 ws0">preter<span class="_ _3"> </span>by<span class="_ _3"> </span>calling<span class="_ _5"> </span>scripts,<span class="_ _3"> </span>which<span class="_ _3"> </span>in<span class="_ _5"> </span>turn<span class="_ _3"> </span>again<span class="_ _3"> </span>might<span class="_ _5"> </span>want<span class="_ _3"> </span>to<span class="_ _3"> </span>access</div><div class="t m0 x2f h5 y250 ff2 fs3 fc0 sc0 ls0 ws0">the<span class="_ _5"> </span>call<span class="_ _7"> </span>stack<span class="_ _5"> </span>or<span class="_ _5"> </span>global<span class="_ _5"> </span>v<span class="_ _2"></span>ariables.<span class="_ _7"> </span>T<span class="_ _2"></span>o<span class="_ _7"> </span>address<span class="_ _5"> </span>this<span class="_ _5"> </span>problem,<span class="_ _7"> </span>we<span class="_ _5"> </span>made</div><div class="t m0 x2f h5 y251 ff2 fs3 fc0 sc0 ls0 ws0">the<span class="_ _5"> </span>VM<span class="_ _7"> </span>set<span class="_ _5"> </span>a<span class="_ _7"> </span>ﬂag<span class="_ _5"> </span>whene<span class="_ _2"></span>v<span class="_ _2"></span>er<span class="_ _7"> </span>the<span class="_ _5"> </span>interpreter<span class="_ _7"> </span>is<span class="_ _5"> </span>reentered<span class="_ _7"> </span>while<span class="_ _5"> </span>a<span class="_ _7"> </span>com-</div><div class="t m0 x2f h5 y252 ff2 fs3 fc0 sc0 ls0 ws0">piled<span class="_ _5"> </span>trace<span class="_ _5"> </span>is<span class="_ _3"> </span>running.</div><div class="t m0 x34 h5 y1d5 ff2 fs3 fc0 sc0 ls0 ws0">Every<span class="_ _5"> </span>call<span class="_ _5"> </span>to<span class="_ _5"> </span>an<span class="_ _7"> </span>external<span class="_ _5"> </span>function<span class="_ _5"> </span>then<span class="_ _5"> </span>checks<span class="_ _5"> </span>this<span class="_ _5"> </span>ﬂag<span class="_ _5"> </span>and<span class="_ _7"> </span>exits</div><div class="t m0 x2f h5 y1d6 ff2 fs3 fc0 sc0 ls0 ws0">the<span class="_ _5"> </span>trace<span class="_ _7"> </span>immediately<span class="_ _5"> </span>after<span class="_ _7"> </span>returning<span class="_ _5"> </span>from<span class="_ _7"> </span>the<span class="_ _5"> </span>e<span class="_ _2"></span>xternal<span class="_ _5"> </span>function<span class="_ _7"> </span>call</div><div class="t m0 x2f h5 y1d7 ff2 fs3 fc0 sc0 ls0 ws0">if<span class="_ _3"> </span>it<span class="_ _5"> </span>is<span class="_ _3"> </span>set.<span class="_ _3"> </span>There<span class="_ _5"> </span>are<span class="_ _3"> </span>many<span class="_ _5"> </span>external<span class="_ _3"> </span>functions<span class="_ _5"> </span>that<span class="_ _3"> </span>seldom<span class="_ _3"> </span>or<span class="_ _5"> </span>nev<span class="_ _2"></span>er</div><div class="t m0 x2f h5 y1d8 ff2 fs3 fc0 sc0 ls0 ws0">reenter<span class="_ _2"></span>,<span class="_ _8"> </span>and<span class="_ _8"> </span>they<span class="_ _8"> </span>can<span class="_ _8"> </span>be<span class="_ _8"> </span>called<span class="_ _8"> </span>without<span class="_ _8"> </span>problem,<span class="_ _d"> </span>and<span class="_ _6"> </span>will<span class="_ _d"> </span>cause</div><div class="t m0 x2f h5 y1d9 ff2 fs3 fc0 sc0 ls0 ws0">trace<span class="_ _5"> </span>exit<span class="_ _5"> </span>only<span class="_ _5"> </span>if<span class="_ _5"> </span>necessary<span class="_ _2"></span>.</div><div class="t m0 x34 h5 y172 ff2 fs3 fc0 sc0 ls0 ws0">The<span class="_ _d"> </span>FFI’<span class="_ _2"></span>s<span class="_ _8"> </span>boxed<span class="_ _8"> </span>value<span class="_ _8"> </span>array<span class="_ _d"> </span>requirement<span class="_ _d"> </span>has<span class="_ _d"> </span>a<span class="_ _8"> </span>performance</div><div class="t m0 x2f h5 y1db ff2 fs3 fc0 sc0 ls0 ws0">cost,<span class="_ _6"> </span>so<span class="_ _8"> </span>we<span class="_ _6"> </span>deﬁned<span class="_ _8"> </span>a<span class="_ _6"> </span>new<span class="_ _6"> </span>FFI<span class="_ _6"> </span>that<span class="_ _8"> </span>allows<span class="_ _6"> </span>C<span class="_ _6"> </span>functions<span class="_ _6"> </span>to<span class="_ _8"> </span>be<span class="_ _6"> </span>an-</div><div class="t m0 x2f h5 y203 ff2 fs3 fc0 sc0 ls0 ws0">notated<span class="_ _3"> </span>with<span class="_ _6"> </span>their<span class="_ _3"> </span>argument<span class="_ _3"> </span>types<span class="_ _3"> </span>so<span class="_ _3"> </span>that<span class="_ _6"> </span>the<span class="_ _3"> </span>tracer<span class="_ _3"> </span>can<span class="_ _6"> </span>call<span class="_ _3"> </span>them</div><div class="t m0 x2f h5 y204 ff2 fs3 fc0 sc0 ls0 ws0">directly<span class="_ _2"></span>,<span class="_ _5"> </span>without<span class="_ _5"> </span>unnecessary<span class="_ _5"> </span>argument<span class="_ _5"> </span>con<span class="_ _2"></span>v<span class="_ _2"></span>ersions.</div><div class="t m0 x34 h5 y1dc ff2 fs3 fc0 sc0 ls0 ws0">Currently<span class="_ _2"></span>,<span class="_ _5"> </span>we<span class="_ _5"> </span>do<span class="_ _5"> </span>not<span class="_ _3"> </span>support<span class="_ _5"> </span>calling<span class="_ _5"> </span>nativ<span class="_ _2"></span>e<span class="_ _5"> </span>property<span class="_ _3"> </span>get<span class="_ _5"> </span>and<span class="_ _5"> </span>set</div><div class="t m0 x2f h5 y1dd ff2 fs3 fc0 sc0 ls0 ws0">ov<span class="_ _2"></span>erride<span class="_ _3"> </span>functions<span class="_ _3"> </span>or<span class="_ _3"> </span>DOM<span class="_ _3"> </span>functions<span class="_ _3"> </span>directly<span class="_ _3"> </span>from<span class="_ _5"> </span>trace.<span class="_ _3"> </span>Support</div><div class="t m0 x2f h5 y1b1 ff2 fs3 fc0 sc0 ls0 ws0">is<span class="_ _5"> </span>planned<span class="_ _5"> </span>future<span class="_ _3"> </span>w<span class="_ _2"></span>ork.</div><div class="t m0 x2f hc yfe ff1 fs3 fc0 sc0 ls0 ws0">6.6<span class="_ _9"> </span>Corr<span class="_ _2"></span>ectness</div><div class="t m0 x2f h5 y95 ff2 fs3 fc0 sc0 ls0 ws0">During<span class="_ _1"> </span>de<span class="_ _2"></span>v<span class="_ _2"></span>elopment,<span class="_ _1"> </span>we<span class="_ _1"> </span>had<span class="_ _d"> </span>access<span class="_ _1"> </span>to<span class="_ _1"> </span>e<span class="_ _2"></span>xisting<span class="_ _1"> </span>Ja<span class="_ _2"></span>v<span class="_ _2"></span>aScript<span class="_ _1"> </span>test</div><div class="t m0 x2f h5 y96 ff2 fs3 fc0 sc0 ls0 ws0">suites,<span class="_ _6"> </span>but<span class="_ _6"> </span>most<span class="_ _6"> </span>of<span class="_ _6"> </span>them<span class="_ _6"> </span>were<span class="_ _8"> </span>not<span class="_ _6"> </span>designed<span class="_ _6"> </span>with<span class="_ _8"> </span>tracing<span class="_ _6"> </span>VMs<span class="_ _6"> </span>in</div><div class="t m0 x2f h5 y97 ff2 fs3 fc0 sc0 ls0 ws0">mind<span class="_ _5"> </span>and<span class="_ _5"> </span>contained<span class="_ _3"> </span>fe<span class="_ _2"></span>w<span class="_ _5"> </span>loops.</div><div class="t m0 x34 h5 y98 ff2 fs3 fc0 sc0 ls0 ws0">One<span class="_ _6"> </span>tool<span class="_ _6"> </span>that<span class="_ _3"> </span>helped<span class="_ _6"> </span>us<span class="_ _6"> </span>greatly<span class="_ _6"> </span>was<span class="_ _6"> </span>Mozilla’<span class="_ _2"></span>s<span class="_ _3"> </span>Jav<span class="_ _2"></span>aScript<span class="_ _3"> </span>fuzz</div><div class="t m0 x2f h5 y99 ff2 fs3 fc0 sc0 ls0 ws0">tester<span class="_ _2"></span>,<span class="_ _6"> </span><span class="fse">J<span class="_ _4"></span>S<span class="_ _4"></span>F<span class="_ _4"></span>U<span class="_ _4"></span>N<span class="_ _4"></span>FU<span class="_ _4"></span>Z<span class="_ _4"></span>Z<span class="_ _4"></span></span>,<span class="_ _3"> </span>which<span class="_ _6"> </span>generates<span class="_ _6"> </span>random<span class="_ _6"> </span>Ja<span class="_ _2"></span>vaScript<span class="_ _3"> </span>programs</div><div class="t m0 x2f h5 y9a ff2 fs3 fc0 sc0 ls0 ws0">by<span class="_ _6"> </span>nesting<span class="_ _8"> </span>random<span class="_ _8"> </span>language<span class="_ _8"> </span>elements.<span class="_ _6"> </span>W<span class="_ _2"></span>e<span class="_ _6"> </span>modiﬁed<span class="_ _8"> </span><span class="fse">J<span class="_ _4"></span>S<span class="_ _4"></span>F<span class="_ _4"></span>U<span class="_ _4"></span>N<span class="_ _4"></span>FU<span class="_ _4"></span>Z<span class="_ _4"></span>Z</span></div><div class="t m0 x2f h5 y9b ff2 fs3 fc0 sc0 ls0 ws0">to<span class="_ _3"> </span>generate<span class="_ _3"> </span>loops,<span class="_ _3"> </span>and<span class="_ _3"> </span>also<span class="_ _3"> </span>to<span class="_ _6"> </span>test<span class="_ _3"> </span>more<span class="_ _3"> </span>heavily<span class="_ _3"> </span>certain<span class="_ _3"> </span>constructs</div><div class="t m0 x2f h5 y9c ff2 fs3 fc0 sc0 ls0 ws0">we<span class="_ _5"> </span>suspected<span class="_ _5"> </span>would<span class="_ _5"> </span>re<span class="_ _2"></span>v<span class="_ _2"></span>eal<span class="_ _5"> </span>ﬂaws<span class="_ _5"> </span>in<span class="_ _5"> </span>our<span class="_ _5"> </span>implementation.<span class="_ _5"> </span>F<span class="_ _2"></span>or<span class="_ _5"> </span>e<span class="_ _2"></span>xam-</div><div class="t m0 x2f h5 y9d ff2 fs3 fc0 sc0 ls0 ws0">ple,<span class="_ _7"> </span>we<span class="_ _5"> </span>suspected<span class="_ _7"> </span>bugs<span class="_ _7"> </span>in<span class="_ _5"> </span>T<span class="_ _2"></span>raceMonk<span class="_ _2"></span>e<span class="_ _2"></span>y’<span class="_ _2"></span>s<span class="_ _7"> </span>handling<span class="_ _7"> </span>of<span class="_ _5"> </span>type-unstable</div><div class="c x32 y253 wb h1f"><div class="t m0 x40 he yba ff16 fsf fc0 sc0 ls0 ws0">!&quot;#<span class="_ _29"> </span>$!&quot;#<span class="_ _2a"> </span>%!&quot;#<span class="_ _2a"> </span>&amp;!&quot;#<span class="_ _2a"> </span>&apos;!&quot;#<span class="_ _2a"> </span>(!&quot;#<span class="_ _2a"> </span>)!&quot;#<span class="_ _2a"> </span>*!&quot;#<span class="_ _2a"> </span>+!&quot;#<span class="_ _2a"> </span>,!&quot;#<span class="_ _e"> </span>$!!&quot;#</div></div><div class="c x85 y6c wc h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&amp;-./012#3%4%56#</div></div><div class="c xad y1c0 wd h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&amp;-.789:;#3%4,56#</div></div><div class="c xae y255 we h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&amp;-.9&lt;=&gt;9&lt;/2#3$4%56#</div></div><div class="c xab y6a wf h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&lt;//2??.1@A&lt;9=.&gt;922?#3!4,56#</div></div><div class="c xaf y1be w10 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&lt;//2??.B&lt;AAC0/;#3%4%56#</div></div><div class="c xb0 y256 w11 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&lt;//2??.A18-=#3&apos;4%56#</div></div><div class="c xb0 y257 w12 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">&lt;//2??.A?@2D2#3&amp;4!56#</div></div><div class="c x7 y1eb w13 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">1@&gt;8:?.&amp;1@&gt;.1@&gt;?.@A.1=&gt;2#3%(4(56#</div></div><div class="c x33 y213 w14 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">1@&gt;8:?.1@&gt;?.@A.1=&gt;2#3+4*56#</div></div><div class="c xb1 y258 w15 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">1@&gt;8:?.1@&gt;E@?2.&lt;A-#3%(4%56#</div></div><div class="c xb2 y1e9 w16 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">1@&gt;8:?.A?@2D2.1@&gt;?#3%4*56#</div></div><div class="c x83 y259 w17 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">/8A&gt;98FG8E.9<span class="_ _2"></span>2/09?@D2#3$4!56#</div></div><div class="c xad ya4 w18 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">/9=:&gt;8.&lt;2?#3$4)56#</div></div><div class="c xae y1e8 w19 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">/9=:&gt;8.7-(#3%4&amp;56#</div></div><div class="c xae y25a w1a h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">/9=:&gt;8.?;&lt;$#3(4,56#</div></div><div class="c xb2 y25b w16 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">-&lt;&gt;2.B897&lt;&gt;<span class="_ _2"></span>.&gt;8H2#3$4$56#</div></div><div class="c x33 y25c w14 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">-&lt;&gt;2.B897&lt;&gt;<span class="_ _2"></span>.5:&lt;91#3$4!56#</div></div><div class="c x84 y151 w1b h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">7&lt;&gt;;./89-@/#3&apos;4,56#</div></div><div class="c x33 y10d w14 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">7&lt;&gt;;.:&lt;9I&lt;F.?07?#3(4,56#</div></div><div class="c xb1 y25d w1c h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">7&lt;&gt;;.?:2/&gt;9&lt;F.A897#3*4$56#</div></div><div class="c xae y25e we h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">92J25:.-A&lt;#3&apos;4%56#</div></div><div class="c xb0 y1 w1d h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">?&gt;9@AJ.1&lt;?2)&apos;#3%4(56#</div></div><div class="c xb3 y25f w1e h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">?&gt;9@AJ.B&lt;?&gt;&lt;#3$4(56#</div></div><div class="c xb4 y260 w1f h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">?&gt;9@AJ.&gt;&lt;J/F80-#3$4$56#</div></div><div class="c xab y0 wf h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">?&gt;9@AJ.0A:&lt;/C./8-2#3$4%56#</div></div><div class="c xb1 y261 w20 h6"><div class="t m0 xac h16 y254 ff16 fs7 fc0 sc0 ls0 ws0">?&gt;9@AJ.D&lt;F@-&lt;&gt;2.@A:0&gt;#3$4,56#</div></div><div class="c x8d y218 w21 h3"><div class="t m0 xb5 he y262 ff16 fsf fc0 sc0 ls0 ws0">KA&gt;29:92&gt;#</div></div><div class="c xb6 y218 w22 h3"><div class="t m0 xb5 he y262 ff16 fsf fc0 sc0 ls0 ws0">L&lt;ID2#</div></div><div class="t m0 x32 hc ye1 ff1 fs3 fc0 sc0 ls0 ws0">Figure<span class="_ _6"> </span>11.<span class="_ _1"> </span>Fraction<span class="_ _8"> </span>of<span class="_ _6"> </span>dynamic<span class="_ _8"> </span>bytecodes<span class="_ _8"> </span>executed<span class="_ _6"> </span>by<span class="_ _8"> </span>inter-</div><div class="t m0 x32 h5 ye2 ff1 fs3 fc0 sc0 ls0 ws0">preter<span class="_ _5"> </span>and<span class="_ _5"> </span>on<span class="_ _3"> </span>nati<span class="_ _2"></span>ve<span class="_ _5"> </span>traces.<span class="_ _5"> </span><span class="ff2">The<span class="_ _5"> </span>speedup<span class="_ _3"> </span>vs.<span class="_ _5"> </span>interpreter<span class="_ _5"> </span>is<span class="_ _3"> </span>sho<span class="_ _2"></span>wn</span></div><div class="t m0 x32 h5 ye3 ff2 fs3 fc0 sc0 ls0 ws0">in<span class="_ _8"> </span>parentheses<span class="_ _d"> </span>next<span class="_ _8"> </span>to<span class="_ _8"> </span>each<span class="_ _d"> </span>test.<span class="_ _8"> </span>The<span class="_ _d"> </span>fraction<span class="_ _8"> </span>of<span class="_ _8"> </span>bytecodes<span class="_ _d"> </span>ex<span class="_ _2"></span>e-</div><div class="t m0 x32 h5 ye4 ff2 fs3 fc0 sc0 ls0 ws0">cuted<span class="_ _d"> </span>while<span class="_ _d"> </span>recording<span class="_ _d"> </span>is<span class="_ _1"> </span>too<span class="_ _8"> </span>small<span class="_ _d"> </span>to<span class="_ _1"> </span>see<span class="_ _8"> </span>in<span class="_ _1"> </span>this<span class="_ _8"> </span>ﬁgure,<span class="_ _1"> </span>e<span class="_ _2"></span>xcept</div><div class="t m0 x32 h5 ye5 ff2 fs3 fc0 sc0 ls0 ws0">for<span class="_ _3"> </span><span class="ff7">crypto-md5</span>,<span class="_ _5"> </span>where<span class="_ _3"> </span>fully<span class="_ _3"> </span>3%<span class="_ _5"> </span>of<span class="_ _3"> </span>bytecodes<span class="_ _3"> </span>are<span class="_ _5"> </span>executed<span class="_ _5"> </span>while</div><div class="t m0 x32 h5 ye6 ff2 fs3 fc0 sc0 ls0 ws0">recording.<span class="_ _6"> </span>In<span class="_ _6"> </span>most<span class="_ _6"> </span>of<span class="_ _6"> </span>the<span class="_ _6"> </span>tests,<span class="_ _6"> </span>almost<span class="_ _6"> </span>all<span class="_ _6"> </span>the<span class="_ _8"> </span>bytecodes<span class="_ _6"> </span>are<span class="_ _6"> </span>ex<span class="_ _2"></span>e-</div><div class="t m0 x32 h5 ye7 ff2 fs3 fc0 sc0 ls0 ws0">cuted<span class="_ _3"> </span>by<span class="_ _3"> </span>compiled<span class="_ _3"> </span>traces.<span class="_ _3"> </span>Three<span class="_ _3"> </span>of<span class="_ _3"> </span>the<span class="_ _3"> </span>benchmarks<span class="_ _3"> </span>are<span class="_ _3"> </span>not<span class="_ _3"> </span>traced</div><div class="t m0 x32 h5 ye8 ff2 fs3 fc0 sc0 ls0 ws0">at<span class="_ _5"> </span>all<span class="_ _5"> </span>and<span class="_ _3"> </span>run<span class="_ _5"> </span>in<span class="_ _5"> </span>the<span class="_ _5"> </span>interpreter<span class="_ _2"></span>.</div><div class="t m0 x32 h5 y1ce ff2 fs3 fc0 sc0 ls0 ws0">loops<span class="_ _5"> </span>and<span class="_ _3"> </span>hea<span class="_ _2"></span>vily<span class="_ _5"> </span>branching<span class="_ _3"> </span>code,<span class="_ _5"> </span>and<span class="_ _3"> </span>a<span class="_ _5"> </span>specialized<span class="_ _5"> </span>fuzz<span class="_ _3"> </span>tester<span class="_ _5"> </span>in-</div><div class="t m0 x32 h5 y1cf ff2 fs3 fc0 sc0 ls0 ws0">deed<span class="_ _7"> </span>revealed<span class="_ _7"> </span>sev<span class="_ _2"></span>eral<span class="_ _7"> </span>regressions<span class="_ _5"> </span>which<span class="_ _7"> </span>we<span class="_ _7"> </span>subsequently<span class="_ _5"> </span>corrected.</div><div class="t m0 x32 h9 y169 ff1 fs1 fc0 sc0 ls0 ws0">7.<span class="_ _a"> </span>Evaluation</div><div class="t m0 x32 h5 y124 ff2 fs3 fc0 sc0 ls0 ws0">W<span class="_ _b"></span>e<span class="_ _d"> </span>ev<span class="_ _2"></span>aluated<span class="_ _d"> </span>our<span class="_ _d"> </span>Ja<span class="_ _2"></span>v<span class="_ _2"></span>aScript<span class="_ _d"> </span>tracing<span class="_ _d"> </span>implementation<span class="_ _8"> </span>using<span class="_ _d"> </span>Sun-</div><div class="t m0 x32 h5 y125 ff2 fs3 fc0 sc0 ls0 ws0">Spider<span class="_ _2"></span>,<span class="_ _3"> </span>the<span class="_ _5"> </span>industry<span class="_ _3"> </span>standard<span class="_ _3"> </span>Jav<span class="_ _2"></span>aScript<span class="_ _3"> </span>benchmark<span class="_ _5"> </span>suite.<span class="_ _3"> </span>SunSpi-</div><div class="t m0 x32 h5 y126 ff2 fs3 fc0 sc0 ls0 ws0">der<span class="_ _3"> </span>consists<span class="_ _6"> </span>of<span class="_ _3"> </span>26<span class="_ _3"> </span>short-running<span class="_ _6"> </span>(less<span class="_ _3"> </span>than<span class="_ _3"> </span>250ms,<span class="_ _6"> </span>a<span class="_ _2"></span>verage<span class="_ _3"> </span>26ms)</div><div class="t m0 x32 h5 y127 ff2 fs3 fc0 sc0 ls0 ws0">Jav<span class="_ _2"></span>aScript<span class="_ _3"> </span>programs.<span class="_ _3"> </span>This<span class="_ _3"> </span>is<span class="_ _5"> </span>in<span class="_ _3"> </span>stark<span class="_ _3"> </span>contrast<span class="_ _3"> </span>to<span class="_ _3"> </span>benchmark<span class="_ _3"> </span>suites</div><div class="t m0 x32 h5 y128 ff2 fs3 fc0 sc0 ls0 ws0">such<span class="_ _3"> </span>as<span class="_ _6"> </span>SpecJVM98<span class="_ _3"> </span>(3)<span class="_ _6"> </span>used<span class="_ _3"> </span>to<span class="_ _6"> </span>e<span class="_ _2"></span>valuate<span class="_ _3"> </span>desktop<span class="_ _3"> </span>and<span class="_ _6"> </span>server<span class="_ _3"> </span>Jav<span class="_ _2"></span>a</div><div class="t m0 x32 h5 y129 ff2 fs3 fc0 sc0 ls0 ws0">VMs.<span class="_ _3"> </span>Man<span class="_ _2"></span>y<span class="_ _5"> </span>programs<span class="_ _3"> </span>in<span class="_ _5"> </span>those<span class="_ _5"> </span>benchmarks<span class="_ _3"> </span>use<span class="_ _5"> </span>large<span class="_ _5"> </span>data<span class="_ _3"> </span>sets<span class="_ _5"> </span>and</div><div class="t m0 x32 h5 y12a ff2 fs3 fc0 sc0 ls0 ws0">ex<span class="_ _2"></span>ecute<span class="_ _5"> </span>for<span class="_ _5"> </span>minutes.<span class="_ _7"> </span>The<span class="_ _5"> </span>SunSpider<span class="_ _5"> </span>programs<span class="_ _7"> </span>carry<span class="_ _5"> </span>out<span class="_ _5"> </span>a<span class="_ _5"> </span>v<span class="_ _2"></span>ariety<span class="_ _7"> </span>of</div><div class="t m0 x32 h5 y12b ff2 fs3 fc0 sc0 ls0 ws0">tasks,<span class="_ _5"> </span>primarily<span class="_ _5"> </span>3d<span class="_ _5"> </span>rendering,<span class="_ _5"> </span>bit-bashing,<span class="_ _5"> </span>cryptographic<span class="_ _7"> </span>encoding,</div><div class="t m0 x32 h5 y12c ff2 fs3 fc0 sc0 ls0 ws0">math<span class="_ _5"> </span>kernels,<span class="_ _5"> </span>and<span class="_ _5"> </span>string<span class="_ _3"> </span>processing.</div><div class="t m0 x33 h5 y12d ff2 fs3 fc0 sc0 ls0 ws0">All<span class="_ _6"> </span>experiments<span class="_ _6"> </span>were<span class="_ _6"> </span>performed<span class="_ _6"> </span>on<span class="_ _8"> </span>a<span class="_ _6"> </span>MacBook<span class="_ _6"> </span>Pro<span class="_ _8"> </span>with<span class="_ _6"> </span>2.2</div><div class="t m0 x32 h5 ycc ff2 fs3 fc0 sc0 ls0 ws0">GHz<span class="_ _5"> </span>Core<span class="_ _5"> </span>2<span class="_ _3"> </span>processor<span class="_ _5"> </span>and<span class="_ _5"> </span>2<span class="_ _5"> </span>GB<span class="_ _5"> </span>RAM<span class="_ _5"> </span>running<span class="_ _5"> </span>MacOS<span class="_ _3"> </span>10.5.</div><div class="t m0 x33 h5 ycd ff1 fs3 fc0 sc0 ls0 ws0">Benchmark<span class="_ _6"> </span>results.<span class="_ _8"> </span><span class="ff2">The<span class="_ _6"> </span>main<span class="_ _8"> </span>question<span class="_ _8"> </span>is<span class="_ _8"> </span>whether<span class="_ _8"> </span>programs</span></div><div class="t m0 x32 h5 yce ff2 fs3 fc0 sc0 ls0 ws0">run<span class="_ _5"> </span>faster<span class="_ _5"> </span>with<span class="_ _5"> </span>tracing.<span class="_ _5"> </span>For<span class="_ _5"> </span>this,<span class="_ _5"> </span>we<span class="_ _5"> </span>ran<span class="_ _5"> </span>the<span class="_ _5"> </span>standard<span class="_ _5"> </span>SunSpider<span class="_ _5"> </span>test</div><div class="t m0 x32 h5 ycf ff2 fs3 fc0 sc0 ls0 ws0">driv<span class="_ _2"></span>er<span class="_ _2"></span>,<span class="_ _6"> </span>which<span class="_ _8"> </span>starts<span class="_ _8"> </span>a<span class="_ _8"> </span>JavaScript<span class="_ _6"> </span>interpreter,<span class="_ _6"> </span>loads<span class="_ _8"> </span>and<span class="_ _8"> </span>runs<span class="_ _8"> </span>each</div><div class="t m0 x32 h5 yd0 ff2 fs3 fc0 sc0 ls0 ws0">program<span class="_ _6"> </span>once<span class="_ _6"> </span>for<span class="_ _6"> </span>warmup,<span class="_ _3"> </span>then<span class="_ _6"> </span>loads<span class="_ _6"> </span>and<span class="_ _6"> </span>runs<span class="_ _6"> </span>each<span class="_ _6"> </span>program<span class="_ _6"> </span>10</div><div class="t m0 x32 h5 yd1 ff2 fs3 fc0 sc0 ls0 ws0">times<span class="_ _3"> </span>and<span class="_ _5"> </span>reports<span class="_ _3"> </span>the<span class="_ _3"> </span>a<span class="_ _2"></span>v<span class="_ _2"></span>erage<span class="_ _3"> </span>time<span class="_ _5"> </span>taken<span class="_ _3"> </span>by<span class="_ _5"> </span>each.<span class="_ _3"> </span>W<span class="_ _b"></span>e<span class="_ _3"> </span>ran<span class="_ _5"> </span>4<span class="_ _3"> </span>differ<span class="_ _2"></span>-</div><div class="t m0 x32 h5 yd2 ff2 fs3 fc0 sc0 ls0 ws0">ent<span class="_ _3"> </span>conﬁgurations<span class="_ _5"> </span>for<span class="_ _3"> </span>comparison:<span class="_ _5"> </span>(a)<span class="_ _5"> </span>SpiderMonkey<span class="_ _2"></span>,<span class="_ _5"> </span>the<span class="_ _3"> </span>baseline</div><div class="t m0 x32 h5 yd3 ff2 fs3 fc0 sc0 ls0 ws0">interpreter<span class="_ _2"></span>,<span class="_ _5"> </span>(b)<span class="_ _3"> </span>T<span class="_ _2"></span>raceMonke<span class="_ _2"></span>y<span class="_ _b"></span>,<span class="_ _3"> </span>(d)<span class="_ _3"> </span>SquirrelFish<span class="_ _5"> </span>Extreme<span class="_ _3"> </span>(SFX),<span class="_ _5"> </span>the</div><div class="t m0 x32 h5 y94 ff2 fs3 fc0 sc0 ls0 ws0">call-threaded<span class="_ _6"> </span>JavaScript<span class="_ _6"> </span>interpreter<span class="_ _8"> </span>used<span class="_ _6"> </span>in<span class="_ _8"> </span>Apple’<span class="_ _2"></span>s<span class="_ _6"> </span>W<span class="_ _2"></span>ebKit,<span class="_ _6"> </span>and</div><div class="t m0 x32 h5 y95 ff2 fs3 fc0 sc0 ls0 ws0">(e)<span class="_ _5"> </span>V8,<span class="_ _5"> </span>the<span class="_ _3"> </span>method-compiling<span class="_ _5"> </span>Ja<span class="_ _2"></span>v<span class="_ _2"></span>aScript<span class="_ _5"> </span>VM<span class="_ _5"> </span>from<span class="_ _5"> </span>Google.</div><div class="t m0 x33 h5 y96 ff2 fs3 fc0 sc0 ls0 ws0">Figure<span class="_ _5"> </span>10<span class="_ _7"> </span>sho<span class="_ _2"></span>ws<span class="_ _7"> </span>the<span class="_ _5"> </span>relati<span class="_ _2"></span>v<span class="_ _2"></span>e<span class="_ _7"> </span>speedups<span class="_ _5"> </span>achie<span class="_ _2"></span>ved<span class="_ _7"> </span>by<span class="_ _5"> </span>tracing,<span class="_ _7"> </span>SFX,</div><div class="t m0 x32 h5 y97 ff2 fs3 fc0 sc0 ls0 ws0">and<span class="_ _5"> </span>V8<span class="_ _3"> </span>against<span class="_ _5"> </span>the<span class="_ _3"> </span>baseline<span class="_ _5"> </span>(SpiderMonkey).<span class="_ _5"> </span>T<span class="_ _2"></span>racing<span class="_ _5"> </span>achieves<span class="_ _5"> </span>the</div><div class="t m0 x32 h5 y98 ff2 fs3 fc0 sc0 ls0 ws0">best<span class="_ _5"> </span>speedups<span class="_ _3"> </span>in<span class="_ _5"> </span>inte<span class="_ _2"></span>ger-hea<span class="_ _2"></span>vy<span class="_ _5"> </span>benchmarks,<span class="_ _5"> </span>up<span class="_ _3"> </span>to<span class="_ _5"> </span>the<span class="_ _5"> </span>25x<span class="_ _5"> </span>speedup</div><div class="t m0 x32 h5 y99 ff2 fs3 fc0 sc0 ls0 ws0">on<span class="_ _5"> </span><span class="ff7">bitops-bitwise-and</span>.</div><div class="t m0 x33 h5 y9a ff2 fs3 fc0 sc0 ls0 ws0">T<span class="_ _2"></span>raceMonke<span class="_ _2"></span>y<span class="_ _d"> </span>is<span class="_ _d"> </span>the<span class="_ _d"> </span>fastest<span class="_ _d"> </span>VM<span class="_ _d"> </span>on<span class="_ _d"> </span>9<span class="_ _d"> </span>of<span class="_ _d"> </span>the<span class="_ _d"> </span>26<span class="_ _8"> </span>benchmarks</div><div class="t m0 x32 h5 y9b ff2 fs3 fc0 sc0 ls0 ws0">(<span class="ff7">3d-morph</span>,<span class="_ _1b"> </span><span class="ff7">bitops-3bit-bits-in-byte</span>,<span class="_ _e"> </span><span class="ff7">bitops-bitwise-</span></div><div class="t m0 x32 h5 y9c ff7 fs3 fc0 sc0 ls0 ws0">and<span class="ff2">,<span class="_ _5"> </span></span>crypto-sha1<span class="ff2">,<span class="_ _5"> </span></span>math-cordic<span class="ff2">,<span class="_ _5"> </span></span>math-partial-sums<span class="ff2">,<span class="_ _3"> </span></span>math-</div><div class="t m0 x32 h5 y9d ff7 fs3 fc0 sc0 ls0 ws0">spectral-norm<span class="ff2">,<span class="_ _d"> </span></span>string-base64<span class="ff2">,<span class="_ _1"> </span></span>string-validate-input<span class="ff2">).</span></div></div><div class="pi" data-data='{"ctm":[1.673203,0.000000,0.000000,1.673203,0.000000,0.000000]}'></div></div></div>
